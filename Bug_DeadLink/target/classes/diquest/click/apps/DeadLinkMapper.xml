<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="DeadLinkMapper.nr">
	<select id="ErrorMinutesCount" resultType="map"> 
		SELECT COUNT(*) AS TOTALSIZE FROM (
		SELECT ROWNUM AS MAINSEQ, DEADLINK.LOG_MSG, DEADLINK.ERROR_CODE, DEADLINK.URL, DEADLINK.BBS_ID, C.RASMBLY_ID, C.RASMBLY_NM FROM 
		(
		SELECT A.LOG_MSG, A.ERROR_CODE, A.URL AS URL, A.BBS_ID AS BBS_ID, B.RASMBLY_ID AS RASMBLY_ID FROM 
			(
			SELECT * FROM 
	            (
	            SELECT * FROM NANET2_LOG
	            UNION
	            SELECT * FROM NANET3_LOG
	            )
			WHERE 
				(ERROR_CODE='1000' OR ERROR_CODE='4000') 
			ORDER BY REG_DATE DESC
			) A, 
			(
			SELECT BBS_ID, RASMBLY_ID, BBS_NAME FROM MINUTES GROUP BY BBS_ID, RASMBLY_ID, BBS_NAME
			) B
		WHERE A.BBS_ID = B.BBS_ID
		) DEADLINK, 
		(
		SELECT RASMBLY_NM, RASMBLY_ID FROM COLGOVER
		) C
		WHERE DEADLINK.RASMBLY_ID = C.RASMBLY_ID
	) DEADLINK
	</select>

	<select id="ErrorBillCount" resultType="map"> 
		SELECT COUNT(*) AS TOTALSIZE FROM (
		SELECT ROWNUM AS MAINSEQ, DEADLINK.LOG_MSG, DEADLINK.ERROR_CODE, DEADLINK.URL, DEADLINK.BBS_ID, C.RASMBLY_ID, C.RASMBLY_NM FROM 
		(
		SELECT A.LOG_MSG, A.ERROR_CODE, A.URL AS URL, A.BBS_ID AS BBS_ID, B.RASMBLY_ID AS RASMBLY_ID FROM 
			(
			SELECT * FROM 
	            (
	            SELECT * FROM NANET2_LOG
	            UNION
	            SELECT * FROM NANET3_LOG
	            )
			WHERE 
				(ERROR_CODE='1000' OR ERROR_CODE='4000') 
			ORDER BY REG_DATE DESC
			) A, 
			(
			SELECT BBS_ID, RASMBLY_ID, BBS_NAME FROM BILL GROUP BY BBS_ID, RASMBLY_ID, BBS_NAME
			) B
		WHERE A.BBS_ID = B.BBS_ID
		) DEADLINK, 
		(
		SELECT RASMBLY_NM, RASMBLY_ID FROM COLGOVER
		) C
		WHERE DEADLINK.RASMBLY_ID = C.RASMBLY_ID
	) DEADLINK
	</select>
	
	<select id="DeadBillCount" resultType="map"> 
		SELECT COUNT(*) AS TOTALSIZE FROM (
		SELECT ROWNUM AS ROWSEQ,DEADLINK.* FROM (
	 SELECT DEADLINK.* FROM (
		SELECT ROWNUM AS MAINSEQ, DEADLINK.LOG_MSG, DEADLINK.ERROR_CODE, DEADLINK.URL, DEADLINK.BBS_ID, C.RASMBLY_ID, C.RASMBLY_NM FROM 
		(
		SELECT A.LOG_MSG, A.ERROR_CODE, A.URL AS URL, A.BBS_ID AS BBS_ID, B.RASMBLY_ID AS RASMBLY_ID FROM 
			(
			SELECT * FROM 
	            (
	            SELECT * FROM NANET2_LOG
	            UNION
	            SELECT * FROM NANET3_LOG
	            )
			WHERE 
				(ERROR_CODE='400' OR ERROR_CODE='500' OR ERROR_CODE='404' OR ERROR_CODE='502' OR ERROR_CODE='503' OR ERROR_CODE='504' OR ERROR_CODE='-1') 
			) A, 
			(
			SELECT BBS_ID, RASMBLY_ID, BBS_NAME FROM BILL GROUP BY BBS_ID, RASMBLY_ID, BBS_NAME
			) B
		WHERE A.BBS_ID = B.BBS_ID
		) DEADLINK, 
		(
		SELECT RASMBLY_NM, RASMBLY_ID FROM COLGOVER
		) C
		WHERE DEADLINK.RASMBLY_ID = C.RASMBLY_ID
	) DEADLINK ORDER BY MAINSEQ DESC) DEADLINK ) 
	</select>
	
	<select id="DeadMinutesCount" resultType="map"> 
		SELECT COUNT(*) AS TOTALSIZE FROM (
	SELECT ROWNUM AS ROWSEQ,DEADLINK.* FROM (
	 SELECT DEADLINK.* FROM (
		SELECT ROWNUM AS MAINSEQ, DEADLINK.LOG_MSG, DEADLINK.ERROR_CODE, DEADLINK.URL, DEADLINK.BBS_ID, C.RASMBLY_ID, C.RASMBLY_NM FROM 
		(
		SELECT A.LOG_MSG, A.ERROR_CODE, A.URL AS URL, A.BBS_ID AS BBS_ID, B.RASMBLY_ID AS RASMBLY_ID FROM 
			(
			SELECT * FROM 
	            (
	            SELECT * FROM NANET2_LOG
	            UNION
	            SELECT * FROM NANET3_LOG
	            )
			WHERE 
				(ERROR_CODE='400' OR ERROR_CODE='500' OR ERROR_CODE='404' OR ERROR_CODE='502' OR ERROR_CODE='503' OR ERROR_CODE='504' OR ERROR_CODE='-1')
			) A, 
			(
			SELECT BBS_ID, RASMBLY_ID, BBS_NAME FROM MINUTES GROUP BY BBS_ID, RASMBLY_ID, BBS_NAME
			) B
		WHERE A.BBS_ID = B.BBS_ID
		) DEADLINK, 
		(
		SELECT RASMBLY_NM, RASMBLY_ID FROM COLGOVER
		) C
		WHERE DEADLINK.RASMBLY_ID = C.RASMBLY_ID
	) DEADLINK ORDER BY MAINSEQ DESC) DEADLINK ) 
	 
	</select>
	
	<select id="BillDaedPage" parameterType="diquest.click.apps.DeadLink" resultType="java.util.HashMap">
	
	SELECT * FROM (
	SELECT ROWNUM AS ROWSEQ,DEADLINK.* FROM (
	 SELECT DEADLINK.* FROM (
		SELECT ROWNUM AS MAINSEQ, DEADLINK.LOG_MSG, DEADLINK.ERROR_CODE, DEADLINK.URL, DEADLINK.BBS_ID, C.RASMBLY_ID, C.RASMBLY_NM FROM 
		(
		SELECT A.LOG_MSG, A.ERROR_CODE, A.URL AS URL, A.BBS_ID AS BBS_ID, B.RASMBLY_ID AS RASMBLY_ID FROM 
			(
			SELECT * FROM 
	            (
	            SELECT * FROM NANET2_LOG
	            UNION
	            SELECT * FROM NANET3_LOG
	            )
			WHERE 
				(ERROR_CODE='400' OR ERROR_CODE='500' OR ERROR_CODE='404' OR ERROR_CODE='502' OR ERROR_CODE='503' OR ERROR_CODE='504' OR ERROR_CODE='-1') 
			) A, 
			(
			SELECT BBS_ID, RASMBLY_ID, BBS_NAME FROM BILL GROUP BY BBS_ID, RASMBLY_ID, BBS_NAME
			) B
		WHERE A.BBS_ID = B.BBS_ID
		) DEADLINK, 
		(
		SELECT RASMBLY_NM, RASMBLY_ID FROM COLGOVER
		) C
		WHERE DEADLINK.RASMBLY_ID = C.RASMBLY_ID
	) DEADLINK ORDER BY MAINSEQ DESC) DEADLINK ) 
	 WHERE ROWSEQ BETWEEN #{firstPage} AND #{LastPage}
	
	</select>
	
	<select id="MinutesDeadPage" parameterType="diquest.click.apps.DeadLink" resultType="java.util.HashMap">
	 	 SELECT * FROM (
	SELECT ROWNUM AS ROWSEQ,DEADLINK.* FROM (
	 SELECT DEADLINK.* FROM (
		SELECT ROWNUM AS MAINSEQ, DEADLINK.LOG_MSG, DEADLINK.ERROR_CODE, DEADLINK.URL, DEADLINK.BBS_ID, C.RASMBLY_ID, C.RASMBLY_NM FROM 
		(
		SELECT A.LOG_MSG, A.ERROR_CODE, A.URL AS URL, A.BBS_ID AS BBS_ID, B.RASMBLY_ID AS RASMBLY_ID FROM 
			(
			SELECT * FROM 
	            (
	            SELECT * FROM NANET2_LOG
	            UNION
	            SELECT * FROM NANET3_LOG
	            )
			WHERE 
				(ERROR_CODE='400' OR ERROR_CODE='500' OR ERROR_CODE='404' OR ERROR_CODE='502' OR ERROR_CODE='503' OR ERROR_CODE='504' OR ERROR_CODE='-1')  
			) A, 
			(
			SELECT BBS_ID, RASMBLY_ID, BBS_NAME FROM MINUTES GROUP BY BBS_ID, RASMBLY_ID, BBS_NAME
			) B
		WHERE A.BBS_ID = B.BBS_ID
		) DEADLINK, 
		(
		SELECT RASMBLY_NM, RASMBLY_ID FROM COLGOVER
		) C
		WHERE DEADLINK.RASMBLY_ID = C.RASMBLY_ID
	) DEADLINK ORDER BY MAINSEQ DESC) DEADLINK ) 
	 WHERE ROWSEQ BETWEEN #{firstPage} AND #{LastPage}
	</select>
	
	<select id="BillErrorPage" parameterType="diquest.click.apps.DeadLink" resultType="java.util.HashMap">
	 SELECT * FROM (
	SELECT ROWNUM AS ROWSEQ,DEADLINK.* FROM (
	 SELECT DEADLINK.* FROM (
		SELECT ROWNUM AS MAINSEQ, DEADLINK.LOG_MSG, DEADLINK.ERROR_CODE, DEADLINK.URL, DEADLINK.BBS_ID, C.RASMBLY_ID, C.RASMBLY_NM FROM 
		(
		SELECT A.LOG_MSG, A.ERROR_CODE, A.URL AS URL, A.BBS_ID AS BBS_ID, B.RASMBLY_ID AS RASMBLY_ID FROM 
			(
			SELECT * FROM 
	            (
	            SELECT * FROM NANET2_LOG
	            UNION
	            SELECT * FROM NANET3_LOG
	            )
			WHERE 
				(ERROR_CODE='1000' OR ERROR_CODE='4000') 
			) A, 
			(
			SELECT BBS_ID, RASMBLY_ID, BBS_NAME FROM BILL GROUP BY BBS_ID, RASMBLY_ID, BBS_NAME
			) B
		WHERE A.BBS_ID = B.BBS_ID
		) DEADLINK, 
		(
		SELECT RASMBLY_NM, RASMBLY_ID FROM COLGOVER
		) C
		WHERE DEADLINK.RASMBLY_ID = C.RASMBLY_ID
	) DEADLINK ORDER BY MAINSEQ DESC) DEADLINK ) 
	 WHERE ROWSEQ BETWEEN #{firstPage} AND #{LastPage}
	</select>
	
		<select id="MinutesErrorPage" parameterType="diquest.click.apps.DeadLink" resultType="java.util.HashMap">
	 SELECT * FROM (
	SELECT ROWNUM AS ROWSEQ,DEADLINK.* FROM (
	 SELECT DEADLINK.* FROM (
		SELECT ROWNUM AS MAINSEQ, DEADLINK.LOG_MSG, DEADLINK.ERROR_CODE, DEADLINK.URL, DEADLINK.BBS_ID, C.RASMBLY_ID, C.RASMBLY_NM FROM 
		(
		SELECT A.LOG_MSG, A.ERROR_CODE, A.URL AS URL, A.BBS_ID AS BBS_ID, B.RASMBLY_ID AS RASMBLY_ID FROM 
			(
			SELECT * FROM 
	            (
	            SELECT * FROM NANET2_LOG
	            UNION
	            SELECT * FROM NANET3_LOG
	            )
			WHERE 
				(ERROR_CODE='1000' OR ERROR_CODE='4000') 
			) A, 
			(
			SELECT BBS_ID, RASMBLY_ID, BBS_NAME FROM MINUTES GROUP BY BBS_ID, RASMBLY_ID, BBS_NAME
			) B
		WHERE A.BBS_ID = B.BBS_ID
		) DEADLINK, 
		(
		SELECT RASMBLY_NM, RASMBLY_ID FROM COLGOVER
		) C
		WHERE DEADLINK.RASMBLY_ID = C.RASMBLY_ID
	) DEADLINK ORDER BY MAINSEQ DESC) DEADLINK ) 
	 WHERE ROWSEQ BETWEEN #{firstPage} AND #{LastPage}
	</select>
	
	<select id="BillRecentPage" parameterType="diquest.click.apps.DeadLink" resultType="java.util.HashMap">
	SELECT MAINSEQ, RASMBLY_ID, RASMBLY_NM, NVL2(COL_CT,COL_CT,0) AS COL_CT, NVL2(COL_CT,'정상적으로 수집중', '최근 한달내 수집 없음') AS COL_CT2 FROM (
	SELECT ROWNUM AS MAINSEQ, B.RASMBLY_ID, B.RASMBLY_NM, A.COL_CT FROM
	(SELECT RASMBLY_ID, COUNT(*) AS COL_CT FROM BILL WHERE REG_DATE BETWEEN TRUNC(SYSDATE) - 30 AND TRUNC(SYSDATE) GROUP BY RASMBLY_ID) A,
	(SELECT RASMBLY_ID, RASMBLY_NM FROM COLGOVER) B
	WHERE B.RASMBLY_ID = A.RASMBLY_ID (+)
	) RECENT
	</select>
	
	<select id="MinutesRecentPage" parameterType="diquest.click.apps.DeadLink" resultType="java.util.HashMap">
	SELECT MAINSEQ, RASMBLY_ID, RASMBLY_NM, NVL2(COL_CT,COL_CT,0) AS COL_CT, NVL2(COL_CT,'정상적으로 수집중', '최근 한달내 수집 없음') AS COL_CT2 FROM (
	SELECT ROWNUM AS MAINSEQ, B.RASMBLY_ID, B.RASMBLY_NM, A.COL_CT FROM
	(SELECT RASMBLY_ID, COUNT(*) AS COL_CT FROM Minutes WHERE REG_DATE BETWEEN TRUNC(SYSDATE) - 30 AND TRUNC(SYSDATE) GROUP BY RASMBLY_ID) A,
	(SELECT RASMBLY_ID, RASMBLY_NM FROM COLGOVER) B
	WHERE B.RASMBLY_ID = A.RASMBLY_ID (+)
	) RECENT
	</select>

</mapper>

